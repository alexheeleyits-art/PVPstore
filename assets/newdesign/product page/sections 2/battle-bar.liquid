<div class="sticky top-0 z-50 w-full bg-white border-b border-gray-100 shadow-sm" data-section-id="{{ section.id }}">
  <div class="max-w-7xl mx-auto px-4 py-3">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
      
      <!-- Battle Status & Timer -->
      <div class="flex items-center gap-4 w-full md:w-auto">
        <div class="flex items-center gap-2 text-red-500 font-bold bg-red-50 px-3 py-1 rounded-full text-sm animate-pulse">
          <span class="w-2 h-2 rounded-full bg-red-600 block"></span>
          LIVE BATTLE
        </div>
        <div class="flex items-center gap-2 font-mono text-gray-800 bg-gray-100 px-3 py-1 rounded text-sm">
          {% render 'icon-clock' %}
          <span id="battle-timer-{{ section.id }}">23:42:15</span>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="flex-1 w-full max-w-2xl flex items-center gap-3">
        <div class="text-right font-bold text-pink-600 w-24">
          SWEET <span class="text-xs text-gray-500 block">Leading</span>
        </div>
        
        <div class="relative h-6 flex-1 bg-gray-100 rounded-full overflow-hidden flex">
          <div 
            id="bar-sweet-{{ section.id }}"
            class="h-full bg-gradient-to-r from-pink-400 to-rose-500 flex items-center justify-end px-2 transition-all duration-1000 ease-out"
            style="width: 54%"
          >
            <span class="text-white text-xs font-bold" id="pct-sweet-{{ section.id }}">54.0%</span>
          </div>
          <div 
            id="bar-savoury-{{ section.id }}"
            class="h-full bg-gradient-to-l from-orange-400 to-amber-500 flex items-center justify-start px-2 transition-all duration-1000 ease-out"
            style="width: 46%"
          >
            <span class="text-white text-xs font-bold" id="pct-savoury-{{ section.id }}">46.0%</span>
          </div>
        </div>

        <div class="text-left font-bold text-amber-600 w-24">
          SAVOURY <span class="text-xs text-gray-500 block">Trailing</span>
        </div>
      </div>

      <!-- CTA -->
      <div class="hidden md:block">
         <a href="{{ section.settings.cta_link }}" class="bg-black text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-800 transition-colors text-decoration-none inline-block">
           {{ section.settings.cta_text }}
         </a>
      </div>

    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    let sweetPct = 54.0;
    const sweetBar = document.getElementById('bar-sweet-{{ section.id }}');
    const savouryBar = document.getElementById('bar-savoury-{{ section.id }}');
    const sweetText = document.getElementById('pct-sweet-{{ section.id }}');
    const savouryText = document.getElementById('pct-savoury-{{ section.id }}');

    setInterval(() => {
       const fluctuation = Math.random() > 0.5 ? 0.1 : -0.1;
       sweetPct = Math.min(Math.max(sweetPct + fluctuation, 53), 55);
       
       if(sweetBar) sweetBar.style.width = sweetPct + '%';
       if(savouryBar) savouryBar.style.width = (100 - sweetPct) + '%';
       if(sweetText) sweetText.innerText = sweetPct.toFixed(1) + '%';
       if(savouryText) savouryText.innerText = (100 - sweetPct).toFixed(1) + '%';
    }, 2000);
  });
</script>

{% schema %}
{
  "name": "Sticky Battle Bar",
  "settings": [
    {
      "type": "text",
      "id": "cta_text",
      "label": "Button Text",
      "default": "JOIN NOW"
    },
    {
      "type": "url",
      "id": "cta_link",
      "label": "Button Link"
    }
  ],
  "presets": [
    {
      "name": "Sticky Battle Bar"
    }
  ]
}
{% endschema %}
